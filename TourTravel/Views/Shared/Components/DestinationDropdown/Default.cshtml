@model List<TourTravel.ViewComponents.DestinationDropdown>

@{
    int? selectedId = ViewBag.SelectedDestinationId as int?;
    var selectedItem = Model.FirstOrDefault(x => x.Id == selectedId);
}

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<style>
    .select2-container--default .select2-selection--single {
        height: 40px !important;
        padding-top: 5px;
    }
</style>

<select id="DestinationId" name="DestinationId" class="form-control" style="height:40px;"></select>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
    $(document).ready(function () {

        const $dropdown = $('#DestinationId');

        $dropdown.select2({
            placeholder: 'Search destination...',
            allowClear: true,
            minimumInputLength: 1,
            ajax: {
                    url: 'https://stg-jungleave-back.jobvritta.com/api/Destination/getDestinationSearch',
                dataType: 'json',
                delay: 250,
                data: function (params) {
                    return { search: params.term };
                },
                processResults: function (data) {
                    return {
                        results: data.map(item => ({
                            id: item.id,
                            text: item.destination
                        }))
                    };
                }
            }
        });

        // ‚≠ê Pre-select saved value
        @if (selectedId != null && selectedItem != null)
        {
                <text>
                    let option = new Option("@selectedItem.Destination", "@selectedItem.Id", true, true);
                    $dropdown.append(option).trigger('change');
                </text>
        }
    });
</script>
