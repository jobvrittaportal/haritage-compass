@await Component.InvokeAsync("HeroSection")

<!-- tour area -->
<div class="tour-area py-120">
    <div class="container">
        <div class="row">

            <!-- Sidebar -->
            <div class="col-lg-4">
                <div class="tour-sidebar">
                    <!-- search area -->
                    <div class="search-area">
                        <div class="search-form-wrapper">
                            <h4>Search Tours</h4>
                            <form id="searchForm" method="get">
                                <div class="row align-items-end">
                                    <div class="col-12 search-input">
                                        <div class="form-group">
                                            <label>Destination</label>
                                            @await Component.InvokeAsync("DestinationDropdown")
                                        </div>
                                    </div>

                                    <div class="col-12 search-input">
                                        <div class="form-group">
                                            <label>Check In</label>
                                            <input type="date" id="checkInDate" name="checkInDate" class="form-control"
                                                   value="@Context.Request.Query["checkInDate"]" />
                                        </div>
                                    </div>

                                    <div class="col-12 search-input">
                                        <div class="form-group">
                                            <label>Check Out</label>
                                            <input type="date" id="checkOutDate" name="checkOutDate" class="form-control"
                                                   value="@Context.Request.Query["checkOutDate"]" />
                                        </div>
                                    </div>

                                    <div class="col-12 mt-10">
                                        <button type="button" id="filterBtn" class="search-btn">
                                            <i class="far fa-search"></i> Find Now
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <!-- search area end -->
                    <!-- Price Range -->
                    <div class="tour-widget">
                        <h4>Price Range</h4>
                        <div class="price-range-box">
                            <div class="price-range-input">
                                <input type="text" readonly id="price-amount">
                            </div>
                            <div class="price-range"></div>
                        </div>
                    </div>
                    <!-- Price Range end -->
                    <!-- Duration Filter -->
                    <div class="tour-widget">
                        <h4>Durations</h4>
                        <ul>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="duration" id="dur1">
                                    <label class="form-check-label" for="dur1">0 - 24 Hours</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="duration" id="dur2">
                                    <label class="form-check-label" for="dur2">1 - 3 Days</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="duration" id="dur3">
                                    <label class="form-check-label" for="dur3">3 - 6 Days</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="duration" id="dur4">
                                    <label class="form-check-label" for="dur4">6 - 9 Days</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="duration" id="dur5">
                                    <label class="form-check-label" for="dur5">9 - 10 Days</label>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <!-- Duration end -->

                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-8">
                <div class="row align-items-center" id="tourCardsContainer">
                    <p>Loading tours...</p>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- tour area end -->
@section Scripts {
    <script>
        $(document).ready(function () {

            // Initialize price range
            $(".price-range").slider({
                range: true,
                min: 100,
                max: 80000,
                values: [500, 80000],
                slide: function (event, ui) {
                    $("#price-amount").val("â‚¹" + ui.values[0] + " - â‚¹" + ui.values[1]);
                },
                change: function (event, ui) {
                    // When price range changes â†’ apply all filters
                    applyFilters(true);
                }
            });

            $("#price-amount").val("â‚¹" + $(".price-range").slider("values", 0) +
                " - â‚¹" + $(".price-range").slider("values", 1));

            // Duration radio button change â†’ apply all filters
            $("input[name='duration']").on("change", function () {
                applyFilters(true);
            });

            // "Find Now" click â†’ only apply destination + dates (ignore price/duration)
            $("#filterBtn").on("click", function () {
                applyFilters(false);
            });

            // Load tours on first page load
            applyFilters(false);


            // ðŸŸ¢ Core Function - Fetch Filtered Tours
            function applyFilters(includePriceAndDuration) {
                const cityId = $("select[name='DestinationId']").val();
                const checkIn = $("#checkInDate").val();
                const checkOut = $("#checkOutDate").val();

                let minDuration = null;
                let maxDuration = null;
                let minPrice = null;
                let maxPrice = null;

                // Only include these filters if explicitly triggered
                if (includePriceAndDuration) {
                    if ($("#dur1").is(":checked")) { minDuration = 0; maxDuration = 24; }
                    else if ($("#dur2").is(":checked")) { minDuration = 24; maxDuration = 72; }
                    else if ($("#dur3").is(":checked")) { minDuration = 72; maxDuration = 144; }
                    else if ($("#dur4").is(":checked")) { minDuration = 144; maxDuration = 216; }
                    else if ($("#dur5").is(":checked")) { minDuration = 216; maxDuration = 240; }

                    minPrice = $(".price-range").slider("values", 0);
                    maxPrice = $(".price-range").slider("values", 1);
                }

                $.ajax({
                    url: '/Tours/GetFilteredPackages',
                    method: 'GET',
                    data: {
                        DestinationId: cityId,
                        checkInDate: checkIn,
                        checkOutDate: checkOut,
                        minPrice: minPrice,
                        maxPrice: maxPrice,
                        minDuration: minDuration,
                        maxDuration: maxDuration
                    },
                    beforeSend: function () {
                        $("#tourCardsContainer").html("<p>Loading tours...</p>");
                    },
                    success: function (html) {
                        $("#tourCardsContainer").html(html);
                    },
                    error: function (xhr) {
                        $("#tourCardsContainer").html("<p>Error: " + xhr.statusText + "</p>");
                    }
                });
            }

        });
    </script>
}

